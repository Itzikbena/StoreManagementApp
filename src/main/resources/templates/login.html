<form id="loginForm" method="POST" action="/login">
  <input type="text" name="username" id="username" placeholder="Username" required />
  <input type="password" name="password" id="password" placeholder="Password" required />
  <input type="hidden" name="_csrf" th:value="${_csrf.token}" />  <!-- Include CSRF token -->
  <button type="submit">Login</button>
</form>
<script>
  const loginForm = document.getElementById('loginForm');

  loginForm.addEventListener('submit', function (event) {
    event.preventDefault(); // Prevent the default form submission

    const formData = new FormData(loginForm);
    const username = formData.get('username');
    const password = formData.get('password');
    const csrfToken = document.querySelector('input[name="_csrf"]').value;

    fetch('/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        'X-CSRF-Token': csrfToken // Include the CSRF token in the headers
      },
      body: new URLSearchParams({
        'username': username,
        'password': password
      }),
      credentials: 'include' // Ensure that credentials like cookies are included
    })
            .then(response => {
              if (response.redirected) {
                window.location.href = response.url;
              } else if (response.ok) {
                return response.text();
              } else {
                throw new Error('Login failed');
              }
            })
            .catch(error => {
              console.error('Error:', error);
              // On error, redirect to the infopage with branchId=1 and userId=4
              window.location.href = 'http://localhost:8080/infopage?branchId=1&userId=4';
            });
  });

</script>
